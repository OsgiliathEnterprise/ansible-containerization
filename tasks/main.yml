---
# tasks file for docker

- name: containerization | create directory
  file:
    path: "{{ ansible_containerization_configuration_folder }}"
    state: directory
  become: true

- name: containerization | check docker volume is formatted in xfs
  shell: "xfs_info {{ ansible_containerization_docker_mountpoint }} | grep -c 'ftype=1'"
  become: yes
  register: mountedxfs
  ignore_errors: true
  changed_when: no

- name: containerization | copy filesystem driver
  copy:
    src: daemon.json
    dest: "{{ ansible_containerization_daemon_configuration_file }}"
  become: true
  notify: containerization | restart service
  when: not mountedxfs is failed

- name: containerization | copy execution driver
  copy:
    src: exec-daemon.json
    dest: "{{ ansible_containerization_daemon_configuration_file }}"
  become: true
  notify: containerization | restart service
  when: mountedxfs is failed

- name: containerization | start
  systemd:
    name: docker
    state: started
    enabled: true
  become: true
